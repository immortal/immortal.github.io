<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on immortal</title>
    <link>https://immortal.run/post/index.xml</link>
    <description>Recent content in Posts on immortal</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright> </copyright>
    <lastBuildDate>Wed, 20 Jul 2016 21:07:15 +0200</lastBuildDate>
    <atom:link href="https://immortal.run/post/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>The problem to solve</title>
      <link>https://immortal.run/post/the-problem-to-solve/</link>
      <pubDate>Wed, 20 Jul 2016 21:07:15 +0200</pubDate>
      
      <guid>https://immortal.run/post/the-problem-to-solve/</guid>
      <description>

&lt;h2 id=&#34;follow-pid&#34;&gt;Follow PID&lt;/h2&gt;

&lt;p&gt;In some cases it is required to supervise applications that
daemonize by default. Normally this kind of applications create a
&lt;a href=&#34;https://en.wikipedia.org/wiki/Process_identifier#Pidfile&#34;&gt;pidfile&lt;/a&gt; every time
they &lt;a href=&#34;https://en.wikipedia.org/wiki/Fork_(system_call)&#34;&gt;fork&lt;/a&gt;, the one can be
used to follow subsequent forks and avoid creating a race condition between
the supervisor trying to start again the process and the forks created by the
application.&lt;/p&gt;

&lt;p&gt;Example of a race condition while trying to supervise unicorn with runit:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://asciinema.org/a/80371&#34;&gt;&lt;img src=&#34;https://asciinema.org/a/80371.png&#34; alt=&#34;asciicast&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the example given below, after forking (&lt;code&gt;kill -USR2 $PID&lt;/code&gt;), The supervisor in use
&lt;code&gt;runit&lt;/code&gt; in this case, tries to start up again the application, since the
process that was supervising died, but instead enters into loop
because the application still up and running using the same port.&lt;/p&gt;

&lt;h2 id=&#34;logging&#34;&gt;logging&lt;/h2&gt;

&lt;p&gt;When working in distributed &amp;ldquo;cloud&amp;rdquo; environments, centralized logging becomes a
requirement, therefore it is desired to have availability to chose how and where
to log, either to a local file, to a local file and to a remote server or only
remotely either TCP or UDP.&lt;/p&gt;

&lt;p&gt;To achive this, &lt;strong&gt;immortal&lt;/strong&gt; is not only capable to write logs to a defined
file, but is also allows to specify an external logger, by specifying the &lt;code&gt;-l&lt;/code&gt;
and &lt;code&gt;-logger&lt;/code&gt; options example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ immortal -l /tmp/test.log -logger &amp;quot;logger -t test&amp;quot; my-app
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In this case &lt;code&gt;-loger&lt;/code&gt; is going to pass the Stander output/error to the
&lt;a href=&#34;https://www.freebsd.org/cgi/man.cgi?logger(1)&#34;&gt;logger&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Example logging to a file and to the system syslog using &lt;code&gt;logger&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://asciinema.org/a/80376&#34;&gt;&lt;img src=&#34;https://asciinema.org/a/80376.png&#34; alt=&#34;asciicast&#34; /&gt;&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>How it works</title>
      <link>https://immortal.run/post/how-it-works/</link>
      <pubDate>Wed, 20 Jul 2016 21:01:08 +0200</pubDate>
      
      <guid>https://immortal.run/post/how-it-works/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://asciinema.org/a/80360&#34;&gt;&lt;img src=&#34;https://asciinema.org/a/80360.png&#34; alt=&#34;asciicast&#34; /&gt;&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>run.yml</title>
      <link>https://immortal.run/post/run.yml/</link>
      <pubDate>Wed, 06 Jul 2016 20:35:39 +0200</pubDate>
      
      <guid>https://immortal.run/post/run.yml/</guid>
      <description>

&lt;h2 id=&#34;immortal-c-run-yml&#34;&gt;immortal -c run.yml&lt;/h2&gt;

&lt;p&gt;A configuration file for running/logging/supervising:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cmd: bundle exec unicorn -c unicorn.rb
cwd: /arena/app-1
env:
    DEBUG: 1
    ENVIRONMENT: production
pid:
    follow: /arena/app-1/unicorn.pid
    parent: /arena/app-1/parent.pid
    child: /arena/app-1/child.pid
log:
    file: /var/log/app-1.log
    age: 86400 # seconds
    num: 7     # int
    size: 1    # MegaBytes
logger: logger -t unicorn
user: www
wait: 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;One of the main ideas behind the &lt;code&gt;run.yml&lt;/code&gt; is to eliminate an
operations/devops dependency while deploying.&lt;/p&gt;

&lt;p&gt;The application &amp;ldquo;micro service&amp;rdquo; can be shipped with a &lt;code&gt;run.yml&lt;/code&gt; and when
doing a CI &amp;amp; CD flow, by simple updating the &lt;code&gt;run.yml&lt;/code&gt; file, the &lt;strong&gt;immortal&lt;/strong&gt;
supervisor could stop, restart, pause, resume the service without need to
logging the server and execute does steps.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>